<!DOCTYPE html> 
<html lang="en"> 
  <head> 
    <meta charset="UTF-8" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
    <title>Phetchaburi AR Scanner</title> 
    <link rel="stylesheet" href="styles.css" /> 
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script> 

    <style> 
      body { 
        margin: 0; 
        overflow: hidden; /* ป้องกันการเลื่อน */ 
      } 
      #ar-container { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        z-index: 1; /* ให้แสดงอยู่ด้านบน */ 
      } 
      .exit-button { 
        position: absolute; 
        top: 20px; 
        right: 20px; 
        background-color: #ff4c4c; 
        color: white; 
        padding: 10px; 
        border: none; 
        border-radius: 5px; 
        cursor: pointer; 
        z-index: 5; /* ทำให้ปุ่มอยู่ด้านบนสุด */ 
      } 
      .exit-button:hover { 
        background-color: #ff1c1c; 
      } 
    </style> 
  </head> 
  <body> 
    <button class="exit-button" onclick="exitScanner()">ออกจากการสแกน</button> 
    <div id="ar-container"> 
      <a-scene mindar-image="imageTargetSrc: markers/targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" embedded>
        
        <!-- Assets ต้องอยู่ภายใน scene --> 
        <a-assets>
          <a-asset-item id="model-cha-am" src="model/Cha-am.glb"></a-asset-item>
          <a-asset-item id="model-tham-chaeng" src="model/Tham-Chaeng.glb"></a-asset-item>
          <a-asset-item id="model-the-chang" src="model/The-Chang.glb"></a-asset-item>
          <a-asset-item id="model-khao" src="model/Khao.glb"></a-asset-item>
          <a-asset-item id="model-phra-nakhon" src="model/Phra-Nakhon.glb"></a-asset-item>
          <a-asset-item id="model-khoi-tem" src="model/Khoi-Tem.glb"></a-asset-item>
          <a-asset-item id="model-phra-ram" src="model/Phra-Ram.glb"></a-asset-item>
          <a-asset-item id="model-wat-mahathat" src="model/Wat-Mahathat.glb"></a-asset-item>
          <a-asset-item id="model-wat-pak" src="model/Wat-Pak.glb"></a-asset-item>
          <a-asset-item id="model-khao-yoi" src="model/Khao-Yoi.glb"></a-asset-item>
        </a-assets>

        <!-- กล้อง --> 
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- P1: Cha-am Beach --> 
        <a-entity mindar-image-target="targetIndex: 0" class="model">
          <a-gltf-model src="model/Cha-am.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P2: Tham Chaeng Temple --> 
        <a-entity mindar-image-target="targetIndex: 1" class="model">
          <a-gltf-model src="model/Tham-Chaeng.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P3: The Chang Hua Man Royal Project --> 
        <a-entity mindar-image-target="targetIndex: 2" class="model">
          <a-gltf-model src="model/The-Chang.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P4: Khao Bandai It Temple --> 
        <a-entity mindar-image-target="targetIndex: 3" class="model">
          <a-gltf-model src="model/Khao.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P5: Phra Nakhon Khiri Historical Park --> 
        <a-entity mindar-image-target="targetIndex: 4" class="model">
          <a-gltf-model src="model/Phra-Nakhon.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P6: Khoi Temple --> 
        <a-entity mindar-image-target="targetIndex: 5" class="model">
          <a-gltf-model src="model/Khoi-Tem.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P7: Phra Ram Ratchaniwet --> 
        <a-entity mindar-image-target="targetIndex: 6" class="model">
          <a-gltf-model src="model/Phra-Ram.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P8: Wat Mahathat Worawihan --> 
        <a-entity mindar-image-target="targetIndex: 7" class="model">
          <a-gltf-model src="model/Wat-Mahathat.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P9: Wat Pak Nok Thale --> 
        <a-entity mindar-image-target="targetIndex: 8" class="model">
          <a-gltf-model src="model/Wat-Pak.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>

        <!-- P10: Khao Yoi Cave Temple --> 
        <a-entity mindar-image-target="targetIndex: 9" class="model">
          <a-gltf-model src="model/Khao-Yoi.glb" scale="15 15 15" position="0 -2 0" rotation="0 0 0"></a-gltf-model>
        </a-entity>
      </a-scene> 
    </div> 

    <script> 
      function exitScanner() { 
        const arContainer = document.getElementById("ar-container"); 
        arContainer.style.display = "none"; 
        window.location.assign("index.html"); 
      } 

      window.onload = function () { 
        const arContainer = document.getElementById("ar-container"); 
        arContainer.style.display = "block"; 
        startScanner(); 
      }; 

      function startScanner() { 
        navigator.mediaDevices 
          .getUserMedia({ video: true }) 
          .then((stream) => { 
            const videoElement = document.createElement("video"); 
            videoElement.srcObject = stream; 
            videoElement.autoplay = true; 
            videoElement.style.width = "100%"; 
            videoElement.style.height = "100%"; 
            videoElement.style.position = "absolute"; 
            videoElement.style.top = "0"; 
            videoElement.style.left = "0"; 
            videoElement.style.zIndex = "0"; 
            document.body.appendChild(videoElement); 
          }) 
          .catch((error) => { 
            console.error("Error accessing the camera:", error); 
          }); 
      } 

      // ฟังก์ชันการหมุนโมเดล
      const models = document.querySelectorAll('.model');

      models.forEach(model => {
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };

        model.addEventListener('mousedown', (event) => {
          isDragging = true;
          previousMousePosition = { x: event.clientX, y: event.clientY };
        });

        model.addEventListener('mouseup', () => {
          isDragging = false;
        });

        model.addEventListener('mouseleave', () => {
          isDragging = false;
        });

        model.addEventListener('mousemove', (event) => {
          if (isDragging) {
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;

            const rotation = model.getAttribute('rotation');
            model.setAttribute('rotation', {
              x: rotation.x + deltaY * 0.1,
              y: rotation.y + deltaX * 0.1,
              z: rotation.z
            });

            previousMousePosition = { x: event.clientX, y: event.clientY };
          }
        });
      });
    </script> 
  </body> 
</html>
